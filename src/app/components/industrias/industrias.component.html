<div class="industrias-container">
  <!-- Header following Gov.br Design System -->
  <header class="br-header compact">
    <div class="container-lg">
      <div class="header-top">
        <div class="header-logo">
          <img src="/assets/bndeslogo.png" alt="BNDES" class="logo" />
        </div>

        <div class="header-actions">
          <div class="header-functions">
            <button 
              class="br-button secondary small" 
              type="button" 
              aria-label="Alto Contraste"
              [class.active]="isHighContrast"
              (click)="toggleHighContrast()">
              <i class="fas fa-adjust" aria-hidden="true"></i>
              <span class="button-text">Alto Contraste</span>
            </button>
            <button 
              class="br-button secondary small" 
              type="button" 
              aria-label="VLibras"
              [class.active]="isVLibrasActive"
              (click)="toggleVLibras()">
              <i class="fas fa-universal-access" aria-hidden="true"></i>
              <span class="button-text">VLibras</span>
            </button>
            <button class="br-button secondary small" type="button" aria-label="Sair" (click)="logout()">
              <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
              <span class="button-text">Sair</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div class="container-lg">
      <!-- Page Header com Menu Hambúrguer -->
      <div class="page-header">
        <div class="page-title-section">
          <div class="title-with-menu">
            <!-- Hamburger Menu posicionado ao lado do título -->
            <app-hamburger-menu [menuItems]="menuItems" [isOpen]="isMenuOpen" (menuToggle)="onMenuToggle($event)"
              (itemClick)="onMenuItemClick($event)">
            </app-hamburger-menu>
            <div class="title-content">
              <h1 class="page-title">Indústrias</h1>
              <p class="page-subtitle">Visualize e administre dados das indústrias</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Search and Actions Section -->
      <div class="search-actions-section">
        <div class="search-input">
          <div class="br-input">
            <input type="text" placeholder="O que você procura?" class="form-control" [(ngModel)]="searchTerm"
              (input)="onSearch()">
            <button class="search-button" type="button">
              <i class="fas fa-search" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <div class="search-actions">
          <button class="br-button primary" type="button" (click)="openCreateModal()">
            <i class="fas fa-plus" aria-hidden="true"></i>
            Criar indústria
          </button>
        </div>
      </div>

      <!-- Table Section -->
      <div class="table-section">
        <!-- Loading Overlay estilizado igual ao login -->
        <div *ngIf="isLoading" class="loading-overlay">
          <br-loading [message]="loadingMessage" size="medium"></br-loading>
        </div>
        
        <div class="table-responsive" *ngIf="!isLoading">
          <table class="br-table">
            <thead>
              <tr>
                <th>CNPJ</th>
                <th>Fazenda</th>
                <th style="text-align: center;">Data do cadastro</th>
                <th>Qnt. de Invent.</th>
                <th>Status</th>
                <th>Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let industria of paginatedData">
                <td>{{ getFormattedCNPJ(industria.cnpj) }}</td>
                <td>{{ industria.fazenda }}</td>
                <td style="text-align: center;">{{ industria.dataCadastro }}</td>
                <td>{{ industria.quantidadeInventarios }}</td>
                <td>
                  <!-- Gov.br Switch Component -->
                  <div class="br-switch small">
                    <input [id]="'switch-' + industria.id" type="checkbox"
                      [checked]="industria.ativo" (click)="toggleStatus(industria.id); $event.preventDefault()" />
                    <label [for]="'switch-' + industria.id">
                      <span class="switch-data" [attr.data-enabled]="'Ativo'" [attr.data-disabled]="'Inativo'">
                      </span>
                    </label>
                  </div>
                </td>
                <td>
                  <div class="action-buttons">
                    <button class="br-button secondary small" type="button"
                      (click)="editarIndustria(industria.id)" aria-label="Editar">
                      <i class="fas fa-edit" aria-hidden="true"></i>
                    </button>
                    <button class="br-button danger small" type="button"
                      (click)="excluirIndustria(industria.id)" aria-label="Excluir">
                      <i class="fas fa-trash" aria-hidden="true"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      
        <!-- Pagination -->
        <div class="pagination-section" *ngIf="!isLoading">
          <div class="pagination-info">
            <span>Exibir</span>
            <select [(ngModel)]="itemsPerPage" class="items-per-page" (change)="changeItemsPerPage(itemsPerPage)">
              <option value="10">10</option>
              <option value="25">25</option>
              <option value="50">50</option>
            </select>
            <span>{{ (currentPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentPage * itemsPerPage, totalItems) }} de
              {{ totalItems }} itens</span>
          </div>
          <div class="pagination-controls">
            <span>Página</span>
            <select [(ngModel)]="currentPage" class="page-select" (change)="changePage(currentPage)">
              <option *ngFor="let page of [].constructor(totalPages); let i = index" [value]="i + 1">
                {{ i + 1 }}
              </option>
            </select>
            <div class="pagination-buttons">
              <button class="br-button secondary small" type="button" (click)="changePage(currentPage - 1)"
                [disabled]="currentPage === 1">
                <i class="fas fa-chevron-left" aria-hidden="true"></i>
              </button>
              <button class="br-button secondary small" type="button" (click)="changePage(currentPage + 1)"
                [disabled]="currentPage === totalPages">
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Create Industria Modal -->
  <div class="modal-overlay" *ngIf="showCreateModal">
    <div class="modal-content modal-right" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Criar indústria</h2>
        <button class="modal-close" type="button" (click)="confirmCloseCreateModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="modal-body">
        <form class="industria-form" (ngSubmit)="$event.preventDefault()" #createForm="ngForm">
          <!-- Top row: CNPJ, Fazenda, Estado -->
          <div class="form-row-top">
            <div class="form-group">
              <label for="cnpj" class="br-label bold-label">CNPJ</label>
              <div class="br-input">
                <input type="text" id="cnpj" name="cnpj" [(ngModel)]="novaIndustria.cnpj"
                  (input)="formatCNPJ($event)" placeholder="55.111.170/0001-35" class="form-control" required
                  maxlength="18" #cnpjInput="ngModel" />
              </div>
              <div *ngIf="cnpjInput.invalid && cnpjInput.touched" class="error-message">
                CNPJ é obrigatório
              </div>
            </div>

            <div class="form-group">
              <label for="fazenda" class="br-label bold-label">Fazenda</label>
              <div class="br-input">
                <input type="text" id="fazenda" name="fazenda" [(ngModel)]="novaIndustria.fazenda"
                  placeholder="Piracanjuba" class="form-control" required #fazendaInput="ngModel" />
              </div>
              <div *ngIf="fazendaInput.invalid && fazendaInput.touched" class="error-message">
                Fazenda é obrigatória
              </div>
            </div>

            <div class="form-group">
              <label for="estado" class="br-label bold-label">Estado</label>
              <div class="br-select">
                <select id="estado" name="estado" [(ngModel)]="novaIndustria.estado" class="form-control" required>
                  <option *ngFor="let estado of estados" [value]="estado.sigla">{{ estado.sigla }}</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Bottom row: Data do cadastro, Inv. tratados, Tipo de indústria, Status -->
          <div class="form-row-bottom">
            <div class="form-group">
              <label for="dataCadastro" class="br-label bold-label">Data do cadastro</label>
              <div class="br-input">
                <input type="text" id="dataCadastro" name="dataCadastro" [value]="currentDateFormatted"
                  class="form-control" readonly />
              </div>
            </div>

            <div class="form-group">
              <label for="inventarios" class="br-label bold-label">Inv. tratados</label>
              <div class="br-input">
                <input type="number" id="inventarios" name="inventarios" [(ngModel)]="novaIndustria.quantidadeInventarios"
                    placeholder="0" class="form-control" readonly />
              </div>
            </div>



            <div class="form-group">
              <label for="status" class="br-label bold-label">Status</label>
              <div class="br-switch">
                <input type="checkbox" id="status" name="status" [(ngModel)]="novaIndustria.ativo" (change)="onIndustriaStatusChange()" />
                <label for="status">
                  <span class="switch-data" data-enabled="Ativo" data-disabled="Inativo"></span>
                </label>
              </div>
            </div>
          </div>

          <!-- Users Section -->
          <div class="users-section">
            <h3 class="users-title">Usuários da Indústria</h3>

            <div class="table-header">
              <div class="table-row">
                <div class="header-text">CPF</div>
                <div class="header-text">Nome</div>
                <div class="header-text">Data de cadastro</div>
                <div class="header-text">Status</div>
                <div class="header-text">Ações</div>
              </div>
            </div>

            <div class="table-body">
              <div class="table-row" *ngFor="let user of industriaUsers; let i = index">
                <input type="text" [(ngModel)]="user.cpf" [name]="'user-cpf-' + i" placeholder="207.299.480-21"
                  maxlength="14" readonly />
                <input type="text" [(ngModel)]="user.nome" [name]="'user-nome-' + i" placeholder="Nome do usuário"
                  readonly />
                <input type="text" [(ngModel)]="user.dataCadastro" [name]="'user-data-' + i" readonly />
                <div class="br-switch">
                  <input type="checkbox" [(ngModel)]="user.ativo" [name]="'user-status-' + i"
                    [id]="'user-status-' + i" (change)="onUserStatusChange(user, $event)" [disabled]="!novaIndustria.ativo" />
                  <label [for]="'user-status-' + i">
                    <span class="switch-data" data-enabled="Ativo" data-disabled="Inativo"></span>
                  </label>
                </div>
                <div class="action-buttons">
                  <button type="button" class="br-button danger small" (click)="removeUser(i)"
                    aria-label="Remover usuário">
                    <i class="fas fa-trash" aria-hidden="true"></i>
                  </button>
                </div>
              </div>

              <!-- Linhas de usuários para preenchimento -->
              <div class="table-row new-user-row" *ngFor="let row of userRows; let i = index">
                <div class="cpf-input-container">
                  <input type="text" [(ngModel)]="row.cpf" [name]="'new-user-cpf-' + i" placeholder="000.000.000-00"
                    (input)="formatCPFInputForRow($event, row, i)" maxlength="14" 
                    [ngClass]="{'invalid-cpf': row.cpfJaExisteEmOutraIndustria || row.cpfInvalido}" />
                  <div *ngIf="row.isCpfLoading || row.isCpfVerificando" class="cpf-loading-indicator">
                    <div class="spinner-border-sm" role="status">
                      <span class="sr-only">Carregando...</span>
                    </div>
                  </div>
                  <div *ngIf="row.cpfJaExisteEmOutraIndustria" class="cpf-error-indicator">
                     <i class="fas fa-exclamation-triangle" aria-hidden="true" title="CPF já está ativo em outra indústria"></i>
                   </div>

                   <div *ngIf="row.cpfInvalido" class="cpf-error-indicator">
                     <i class="fas fa-times-circle" aria-hidden="true" title="CPF inválido"></i>
                   </div>
                 </div>
                 <div *ngIf="row.cpfJaExisteEmOutraIndustria" class="cpf-error-message">
                    <div class="text-danger">Este CPF já está ativo em outra indústria</div>
                   </div>

                  <div *ngIf="row.cpfInvalido" class="cpf-error-message">
                    <div class="text-danger">CPF inválido</div>
                  </div>
                <input type="text" [(ngModel)]="row.nome" [name]="'new-user-nome-' + i" placeholder="Nome do usuário" class="readonly-field" readonly />
                <input type="text" [value]="row.dataCadastro" [name]="'new-user-data-' + i" class="readonly-field" readonly />
                <div class="br-switch">
                  <input type="checkbox" [(ngModel)]="row.ativo" [name]="'new-user-status-' + i" [id]="'new-user-status-' + i" [disabled]="!novaIndustria.ativo" />
                  <label [for]="'new-user-status-' + i">
                    <span class="switch-data" data-enabled="Ativo" data-disabled="Inativo"></span>
                  </label>
                </div>
                <div class="action-buttons">
                  <button type="button" class="br-button secondary small" (click)="removeUserRow(i)"
                    *ngIf="userRows.length > 1 || (row.cpf && row.cpf.trim() !== '') || (row.nome && row.nome.trim() !== '')"
                    aria-label="Remover linha">
                    <i class="fas fa-trash" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="add-user-button">
              <button type="button" class="br-button" (click)="addUserRow()"
                [disabled]="!canAddNewRow()">
                <i class="fas fa-plus" aria-hidden="true"></i>
                Adicionar usuário
              </button>
            </div>
          </div>

          <!-- Modal Actions -->
          <div class="modal-actions">
            <button type="button" class="br-button secondary" (click)="confirmCloseCreateModal()">
              Cancelar
            </button>
            <button type="submit" class="br-button primary" [disabled]="createForm.invalid" (click)="confirmSubmitCreate()">
              Confirmar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Industria Modal -->
  <div class="modal-overlay" *ngIf="showEditModal">
    <div class="modal-content modal-right" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Editar indústria</h2>
        <button class="modal-close" type="button" (click)="confirmCloseEditModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="modal-body">
        <p class="modal-description">Edite os dados da indústria <strong>{{ selectedItem?.fazenda }}</strong>.</p>

        <form class="industria-form" (ngSubmit)="$event.preventDefault()" #editForm="ngForm">
          <!-- Top row: CNPJ, Fazenda -->
          <div class="form-row">
            <div class="form-group">
              <label for="edit-cnpj" class="br-label bold-label">CNPJ</label>
              <div class="br-input">
                <input type="text" id="edit-cnpj" name="cnpj" [(ngModel)]="novaIndustria.cnpj"
                  placeholder="12.345.678/0001-90" class="form-control readonly-field" readonly />
              </div>
            </div>

            <div class="form-group">
              <label for="edit-fazenda" class="br-label bold-label">Nome da fazenda</label>
              <div class="br-input">
                <input type="text" id="edit-fazenda" name="fazenda" [(ngModel)]="novaIndustria.fazenda"
                  placeholder="Nome da fazenda" class="form-control readonly-field" readonly />
              </div>
            </div>
          </div>

          <!-- Second row: Data de Cadastro -->
          <div class="form-group">
            <label for="edit-data-cadastro" class="br-label bold-label">Data de cadastro</label>
            <div class="br-input">
              <input type="text" id="edit-data-cadastro" name="dataCadastro" [value]="selectedItem?.dataCadastro"
                placeholder="DD/MM/AAAA" class="form-control readonly-field" readonly />
            </div>
          </div>

          <!-- Third row: Estado, Inventários tratados -->
          <div class="form-row">
            <div class="form-group">
              <label for="edit-estado" class="br-label bold-label">Estado</label>
              <div class="br-select">
                <select id="edit-estado" name="estado" [(ngModel)]="novaIndustria.estado" class="form-control"
                  required>
                  <option *ngFor="let estado of estados" [value]="estado.sigla">{{ estado.sigla }}</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="edit-inventarios" class="br-label bold-label">Inventários tratados</label>
              <div class="br-input">
                <input type="number" id="edit-inventarios" name="inventarios" [(ngModel)]="novaIndustria.quantidadeInventarios"
                    placeholder="0" class="form-control" readonly />
              </div>
            </div>
          </div>

          <!-- Fourth row: Status -->
          <div class="form-group">
            <label for="edit-status" class="br-label bold-label">Status</label>
            <div class="br-switch">
              <input type="checkbox" id="edit-status" name="status" [(ngModel)]="novaIndustria.ativo" (change)="onIndustriaStatusChange()" />
              <label for="edit-status">
                <span class="switch-data" data-enabled="Ativo" data-disabled="Inativo"></span>
              </label>
            </div>
          </div>

          <div class="users-section">
            <h3 class="users-title">Usuários da Indústria</h3>

            <div class="table-header">
              <div class="table-row">
                <div class="header-text">CPF</div>
                <div class="header-text">Nome</div>
                <div class="header-text">Data de cadastro</div>
                <div class="header-text">Status</div>
                <div class="header-text">Ações</div>
              </div>
            </div>

            <div class="table-body">
              <div class="table-row" *ngFor="let user of industriaUsers; let i = index">
                <input type="text" [(ngModel)]="user.cpf" [name]="'edit-user-cpf-' + i" placeholder="207.299.480-21"
                  maxlength="14" readonly />
                <input type="text" [(ngModel)]="user.nome" [name]="'edit-user-nome-' + i" placeholder="Nome do usuário"
                  readonly />
                <input type="text" [(ngModel)]="user.dataCadastro" [name]="'edit-user-data-' + i" readonly />
                <div class="br-switch">
                  <input type="checkbox" [(ngModel)]="user.ativo" [name]="'edit-user-status-' + i"
                    [id]="'edit-user-status-' + i" (change)="onUserStatusChange(user, $event)" [disabled]="!novaIndustria.ativo" />
                  <label [for]="'edit-user-status-' + i">
                    <span class="switch-data" data-enabled="Ativo" data-disabled="Inativo"></span>
                  </label>
                </div>
                <div class="action-buttons">
                  <button type="button" class="br-button danger small" (click)="removeUser(i)"
                    aria-label="Remover usuário">
                    <i class="fas fa-trash" aria-hidden="true"></i>
                  </button>
                </div>
              </div>

              <!-- Linhas de usuários para preenchimento -->
              <div class="table-row new-user-row" *ngFor="let row of userRows; let i = index">
                <div class="cpf-input-container">
                  <input type="text" [(ngModel)]="row.cpf" [name]="'edit-new-user-cpf-' + i" placeholder="000.000.000-00"
                    (input)="formatCPFInputForRow($event, row, i)" maxlength="14" 
                    [ngClass]="{'invalid-cpf': row.cpfJaExisteEmOutraIndustria || row.cpfInvalido}" />
                  <div *ngIf="row.isCpfLoading || row.isCpfVerificando" class="cpf-loading-indicator">
                    <div class="spinner-border-sm" role="status">
                      <span class="sr-only">Carregando...</span>
                    </div>
                  </div>
                  <div *ngIf="row.cpfJaExisteEmOutraIndustria" class="cpf-error-indicator">
                     <i class="fas fa-exclamation-triangle" aria-hidden="true" title="CPF já está ativo em outra indústria"></i>
                   </div>

                   <div *ngIf="row.cpfInvalido" class="cpf-error-indicator">
                     <i class="fas fa-times-circle" aria-hidden="true" title="CPF inválido"></i>
                   </div>
                 </div>
                 <div *ngIf="row.cpfJaExisteEmOutraIndustria" class="cpf-error-message">
                    <div class="text-danger">Este CPF já está ativo em outra indústria</div>
                   </div>

                  <div *ngIf="row.cpfInvalido" class="cpf-error-message">
                    <div class="text-danger">CPF inválido</div>
                  </div>
                <input type="text" [(ngModel)]="row.nome" [name]="'edit-new-user-nome-' + i" placeholder="Nome do usuário" class="readonly-field" readonly />
                <input type="text" [value]="row.dataCadastro" [name]="'edit-new-user-data-' + i" class="readonly-field" readonly />
                <div class="br-switch">
                  <input type="checkbox" [(ngModel)]="row.ativo" [name]="'edit-new-user-status-' + i" [id]="'edit-new-user-status-' + i" [disabled]="!novaIndustria.ativo" />
                  <label [for]="'edit-new-user-status-' + i">
                    <span class="switch-data" data-enabled="Ativo" data-disabled="Inativo"></span>
                  </label>
                </div>
                <div class="action-buttons">
                  <button type="button" class="br-button secondary small" (click)="removeUserRow(i)"
                    *ngIf="userRows.length > 1 || (row.cpf && row.cpf.trim() !== '') || (row.nome && row.nome.trim() !== '')"
                    aria-label="Remover linha">
                    <i class="fas fa-trash" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="add-user-button">
              <button type="button" class="br-button" (click)="addUserRow()"
                [disabled]="!canAddNewRow()">
                <i class="fas fa-plus" aria-hidden="true"></i>
                Adicionar usuário
              </button>
            </div>
          </div>

          <!-- Modal Actions -->
          <div class="modal-actions">
            <button type="button" class="br-button secondary" (click)="confirmCloseEditModal()">
              Cancelar
            </button>
            <button type="submit" class="br-button primary" [disabled]="editForm.invalid" (click)="confirmSubmitEdit()">
              Confirmar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal with Gov.br Design System -->
  <div class="br-scrim foco" *ngIf="showDeleteModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="deleteModalScrim">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">Confirmar exclusão</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeDeleteModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-exclamation-triangle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            Tem certeza que deseja excluir a indústria <strong>{{ selectedItem?.fazenda }}</strong> (CNPJ: {{
            getFormattedCNPJ(selectedItem?.cnpj || '') }})?
          </p>
          <p class="delete-warning text-warning-dark">
            Esta ação não pode ser desfeita e todos os dados relacionados serão perdidos.
          </p>
        </div>
      </div>

      <div class="br-modal-footer d-flex align-items-center justify-content-between">
        <button type="button" class="br-button secondary" data-dismiss="true" (click)="closeDeleteModal()">
          Cancelar
        </button>
        <button type="button" class="br-button danger" (click)="confirmDelete()">
          <i class="fas fa-trash mr-1" aria-hidden="true"></i>
          Excluir indústria
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmação para cancelar -->
  <div class="br-scrim foco" *ngIf="showCancelConfirmModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="cancelConfirmModalScrim">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">Confirmar cancelamento</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeCancelConfirmModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-question-circle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            Tem certeza que deseja cancelar? Todas as alterações não salvas serão perdidas.
          </p>
        </div>
      </div>

      <div class="br-modal-footer d-flex align-items-center justify-content-between">
        <button type="button" class="br-button secondary" data-dismiss="true" (click)="closeCancelConfirmModal()">
        Continuar editando
      </button>
        <button type="button" class="br-button danger" (click)="confirmCancel()">
          <i class="fas fa-times mr-1" aria-hidden="true"></i>
          Sim, cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de erro - usuário obrigatório -->
  <div class="br-scrim foco" *ngIf="showUserErrorModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="userErrorModalScrim">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">Usuário obrigatório</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeUserErrorModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-exclamation-triangle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            É necessário adicionar pelo menos um usuário à indústria.
          </p>
        </div>
      </div>

      <div class="br-modal-footer d-flex align-items-center justify-content-center">
        <button type="button" class="br-button primary" (click)="closeUserErrorModal()">
          <i class="fas fa-check mr-1" aria-hidden="true"></i>
          Entendi
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de alerta - usuário ativo em outro local -->
  <div class="br-scrim foco" *ngIf="showUserActiveModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="userActiveModalScrim" (click)="closeUserActiveModal()">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">Usuário já ativo</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeUserActiveModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-exclamation-triangle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message" *ngIf="usuarioAtivoInfo">
            O usuário com este CPF já está ativo na {{ usuarioAtivoInfo.tipo === 'certificadora' ? 'certificadora' : 'indústria' }}: <strong>{{ usuarioAtivoInfo.nome }}</strong>.<br><br>
            Para adicionar este usuário nesta indústria, você deve primeiro desativá-lo no local onde está atualmente ativo.
          </p>
        </div>
      </div>

      <div class="br-modal-footer justify-content-center">
        <button type="button" class="br-button primary" (click)="closeUserActiveModal()">
          <i class="fas fa-check mr-1" aria-hidden="true"></i>
          Entendi
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de alerta - usuário inativo no administrador -->
  <div class="br-scrim foco" *ngIf="showUserInactiveAdminModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="userInactiveAdminModalScrim" (click)="closeUserInactiveAdminModal()">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">Usuário inativo no administrador</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeUserInactiveAdminModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-exclamation-triangle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            Este usuário está inativo no administrador do sistema.<br><br>
            Para ativar este usuário nesta indústria, é necessário primeiro reativá-lo no módulo de administradores.
          </p>
        </div>
      </div>

      <div class="br-modal-footer justify-content-center">
        <button type="button" class="br-button primary" (click)="closeUserInactiveAdminModal()">
          <i class="fas fa-check mr-1" aria-hidden="true"></i>
          Entendi
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmação para salvar -->
  <div class="br-scrim foco" *ngIf="showSaveConfirmModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="saveConfirmModalScrim">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">Confirmar {{ isEditMode ? 'alteração' : 'criação' }}</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeSaveConfirmModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-check-circle text-success" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            Tem certeza que deseja {{ isEditMode ? 'salvar as alterações' : 'criar a indústria' }}?
          </p>
        </div>
      </div>

      <div class="br-modal-footer d-flex align-items-center justify-content-between">
        <button type="button" class="br-button secondary" data-dismiss="true" (click)="closeSaveConfirmModal()">
        Cancelar
      </button>
        <button type="button" class="br-button primary" (click)="confirmSave()">
          <i class="fas fa-check mr-1" aria-hidden="true"></i>
          {{ isEditMode ? 'Confirmar' : 'Confirmar criação' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Modal para CNPJ já cadastrado -->
  <div class="br-scrim foco" *ngIf="showCnpjExistsModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="cnpjExistsModalScrim" (click)="closeCnpjExistsModal()">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">CNPJ já cadastrado</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeCnpjExistsModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-exclamation-triangle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            Este CNPJ já está cadastrado no sistema. Por favor, verifique os dados e tente novamente.
          </p>
        </div>
      </div>

      <div class="br-modal-footer d-flex align-items-center justify-content-center">
        <button type="button" class="br-button primary" (click)="closeCnpjExistsModal()">
          <i class="fas fa-check mr-1" aria-hidden="true"></i>
          Entendi
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmação para mudança de status -->
  <div class="br-scrim foco" *ngIf="showStatusConfirmModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="statusConfirmModalScrim">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">Confirmar mudança de status</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeStatusConfirmModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-question-circle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            Tem certeza que deseja {{ pendingStatusChange?.newStatus ? 'ativar' : 'inativar' }} a indústria 
            <strong>{{ selectedItem?.fazenda }}</strong>?
          </p>
        </div>
      </div>

      <div class="br-modal-footer d-flex align-items-center justify-content-between">
        <button type="button" class="br-button secondary" data-dismiss="true" (click)="closeStatusConfirmModal()">
          Cancelar
        </button>
        <button type="button" class="br-button primary" (click)="confirmStatusChange()">
          <i class="fas fa-check mr-1" aria-hidden="true"></i>
          {{ pendingStatusChange?.newStatus ? 'Ativar' : 'Inativar' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de confirmação de exclusão de usuário -->
  <div class="br-scrim foco" *ngIf="showDeleteUserModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="deleteUserModalScrim">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">Confirmar exclusão</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeDeleteUserModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-exclamation-triangle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            Tem certeza que deseja remover o usuário <strong>{{ selectedUserIndex !== null ? industriaUsers[selectedUserIndex]?.nome : '' }}</strong> (CPF: {{ selectedUserIndex !== null ? formatCPFDisplay(industriaUsers[selectedUserIndex]?.cpf || '') : '' }}) da lista?
          </p>
          <p class="delete-warning text-warning-dark">
            Esta ação removerá o usuário da lista atual, mas não o excluirá permanentemente do sistema.
          </p>
        </div>
      </div>

      <div class="br-modal-footer d-flex align-items-center justify-content-between">
        <button type="button" class="br-button secondary" data-dismiss="true" (click)="closeDeleteUserModal()">
          Cancelar
        </button>
        <button type="button" class="br-button danger" (click)="confirmDeleteUser()">
          <i class="fas fa-trash mr-1" aria-hidden="true"></i>
          Remover usuário
        </button>
      </div>
    </div>
  </div>

  <!-- Modal CPF Não Encontrado -->
  <div class="br-scrim foco" *ngIf="showCpfNotFoundModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="cpfNotFoundModalScrim">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">CPF não encontrado</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeCpfNotFoundModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-exclamation-triangle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            O CPF informado não foi encontrado na base de dados.<br><br>
            Verifique se o CPF está correto ou se o usuário já foi cadastrado no sistema.
          </p>
        </div>
      </div>

      <div class="br-modal-footer">
        <button class="br-button secondary" type="button" (click)="closeCpfNotFoundModal()">
          Entendi
        </button>
      </div>
    </div>
  </div>

  <!-- Modal CPF já cadastrado -->
  <div class="br-scrim foco" *ngIf="showCpfExistsModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="cpfExistsModalScrim">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">CPF já cadastrado</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeCpfExistsModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-exclamation-triangle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message" *ngIf="cpfExistsInfo">
            O usuário com este CPF já está ativo na {{ cpfExistsInfo.tipo }}: <strong>{{ cpfExistsInfo.nome }}</strong>.<br><br>
            Para adicionar este usuário nesta indústria, você deve primeiro desativá-lo no local onde está atualmente ativo.
          </p>
        </div>
      </div>

      <div class="br-modal-footer">
        <button class="br-button secondary" type="button" (click)="closeCpfExistsModal()">
          Entendi
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de campos obrigatórios -->
  <div class="br-scrim foco" *ngIf="showRequiredFieldsModal" data-scrim="true" aria-modal="true" role="dialog"
    data-visible="true" id="requiredFieldsModalScrim" (click)="closeRequiredFieldsModal()">
    <div class="br-modal small" (click)="$event.stopPropagation()">
      <div class="br-modal-header">
        <div class="modal-title">Campos obrigatórios</div>
        <button class="br-button circle small" type="button" aria-label="Fechar modal" data-dismiss="true"
          (click)="closeRequiredFieldsModal()">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>

      <div class="br-modal-body">
        <div class="delete-confirmation">
          <div class="delete-icon">
            <i class="fas fa-exclamation-triangle text-warning-dark" aria-hidden="true"></i>
          </div>
          <p class="delete-message">
            Os seguintes campos são obrigatórios e devem ser preenchidos:
          </p>
          <ul class="required-fields-list">
            <li *ngFor="let error of requiredFieldsErrors">{{ error }}</li>
          </ul>
        </div>
      </div>

      <div class="br-modal-footer justify-content-center">
        <button type="button" class="br-button primary" (click)="closeRequiredFieldsModal()">
          <i class="fas fa-check mr-1" aria-hidden="true"></i>
          Entendi
        </button>
      </div>
    </div>
  </div>

</div>